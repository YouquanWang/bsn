{"version":3,"sources":["webpack:///./src/views/list/pool.vue","webpack:///./src/views/list/pool.vue?e07d","webpack:///./src/views/list/pool.vue?da1f"],"names":["class","left-arrow","title","$goBack","records","item","dayNum","amount","isGive","Number","getDividends","setup","store","data","address","state","accounts","web3","provider","BsnContract","BusdContract","freezeContract","windTokenContract","BsnDataContract","initContract","eth","Contract","BSNAbi","config","BsnAddress","BusdAddress","BSNDataAbi","BsnDataAddress","windToken","initData","getList","arr","methods","getCurDayNum","call","decimals","i","from","curIncome","isDividend","params","dividedBy","Math","pow","toFixed","push","console","log","day","getGasPrice","gasPrice","receiveDividends","send","val","refData","render","__scopeId"],"mappings":"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","file":"static/js/chunk-f528a72a.89a91a89.js","sourcesContent":["<template>\r\n  <div class=\"container bg-container\">\r\n    <van-nav-bar\r\n      left-arrow\r\n      title=\"矿池分红记录\"\r\n      @click-left=\"$goBack\" />\r\n    <div class=\"list\">\r\n      <div class=\"item flex-middle\"  v-for=\"item in records\">\r\n        <div class=\"flex-item\">\r\n          <div class=\"flex row\">\r\n            <div class=\"label\">结算周期：</div>\r\n            <div class=\"flex-item cont\">{{item.dayNum}}</div>\r\n          </div>\r\n          <div class=\"flex row\">\r\n            <div class=\"label\">分红数量：</div>\r\n            <div class=\"flex-item cont\">{{item.amount}} Wind Token</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"btn\" v-if=\"!item.isGive && Number(item.amount)\" @click=\"getDividends(item.dayNum)\">领取</div>\r\n        <div class=\"num c-2FBBA1\" v-else>已领取</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import { Toast } from 'vant';\r\nimport { reactive, toRefs, computed, watch} from \"vue\";\r\nimport BSNAbi from \"@/utils/BSNAbi\";\r\nimport tokenAbi from \"@/utils/abi\";\r\nimport config from \"@/utils/config\";\r\nimport {useStore} from \"vuex\";\r\nimport Bignumber from \"bignumber.js\";\r\nimport BSNDataAbi from \"@/utils/BSNDataAbi\";\r\nexport default {\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      records: [],\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      BsnContract: null,\r\n      BusdContract: null,\r\n      freezeContract: null,\r\n      windTokenContract: null,\r\n      BsnDataContract: null,\r\n      initContract: () => {\r\n        data.BsnContract = new data.web3.eth.Contract(BSNAbi, config.BsnAddress)\r\n        data.BusdContract = new data.web3.eth.Contract(tokenAbi, config.BusdAddress)\r\n        data.BsnDataContract = new data.web3.eth.Contract(BSNDataAbi, config.BsnDataAddress)\r\n        data.windTokenContract = new data.web3.eth.Contract(tokenAbi, config.windToken)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getList()\r\n      },\r\n      getList: async () => {\r\n      \r\n        let arr = [];\r\n        let dayNum = await data.BsnDataContract.methods.getCurDayNum().call()\r\n        let decimals = await data.windTokenContract.methods.decimals().call();\r\n        for(let i = 1; i < dayNum; i++) {\r\n          let curIncome = await data.BsnContract.methods.getDividends(i).call({from: data.address})\r\n          let isGive = await data.BsnDataContract.methods.isDividend(data.address, i).call({from: data.address})\r\n          let params = {\r\n            amount: new Bignumber(curIncome).dividedBy(Math.pow(10, decimals)).toFixed(3),\r\n            isGive: isGive,\r\n            dayNum: i\r\n          }\r\n          arr.push(params)\r\n        }\r\n        data.records = arr;\r\n        console.log(arr)\r\n      },\r\n      getDividends: async (day) => {\r\n         let gasPrice = await data.web3.eth.getGasPrice()\r\n         await data.BsnContract.methods.receiveDividends(day).send({from: data.address, gasPrice: gasPrice})\r\n         data.getList()\r\n      }\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n     watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.list {\r\n  margin: 15px;\r\n  border-radius: 25px;\r\n  background: #fff;\r\n  padding: 20px 15px;\r\n  .item {\r\n    background: #EEEAF4;\r\n    border-radius: 13px;\r\n    padding: 13px 12px;\r\n    color: #8F80BA;\r\n    .row + .row {\r\n      margin: 6px 0 0;\r\n    }\r\n    .cont {\r\n      word-break: break-all;\r\n    }\r\n    .num {\r\n      font-size: 15px;\r\n      font-weight: bold;\r\n    }\r\n     .btn {\r\n    padding: 0 17px;\r\n    color: #fff;\r\n    line-height: 23px;\r\n    border-radius: 12px;\r\n    font-size: 13px;\r\n    background: #1FC7D4;\r\n  }\r\n  }\r\n  .item + .item {\r\n    margin-top: 15px;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./pool.vue?vue&type=template&id=3124b424&scoped=true\"\nimport script from \"./pool.vue?vue&type=script&lang=js\"\nexport * from \"./pool.vue?vue&type=script&lang=js\"\n\nimport \"./pool.vue?vue&type=style&index=0&id=3124b424&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-3124b424\"\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./pool.vue?vue&type=style&index=0&id=3124b424&lang=less&scoped=true\""],"sourceRoot":""}